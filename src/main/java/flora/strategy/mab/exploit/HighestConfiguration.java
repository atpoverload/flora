package flora.strategy.mab.exploit;

import static java.util.Comparator.comparing;

import flora.Knob;
import flora.strategy.mab.ExploitationPolicy;
import flora.strategy.mab.MultiArmedBanditContext;
import java.util.Map;

/** An {@link ExploitationPolicy} that selects the configuration with the highest average reward. */
public final class HighestConfiguration implements ExploitationPolicy {
  private static final HighestConfiguration instance = new HighestConfiguration();

  public static HighestConfiguration getPolicy() {
    return instance;
  }

  /** Returns the config with the largest average reward. */
  @Override
  public Map<String, Knob> exploit(MultiArmedBanditContext context) {
    return context.getConfigurations().stream()
        .max(comparing(k -> context.getAverageReward(k)))
        .orElseThrow(
            () -> new IllegalStateException("Exploitation was requested with no evaluations."));
  }

  private HighestConfiguration() {}
}
